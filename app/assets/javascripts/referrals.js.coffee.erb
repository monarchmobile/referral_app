# Place all the behaviors and hooks related to the matching controller here.
# All this logic will automatically be available in application.js.
# You can use CoffeeScript in this file: http://jashkenas.github.com/coffee-script/
jQuery -> 

	$.fn.change_participants = ->
	  $(this).change ->
		  chosen_user_id = $(this).val()
		  starts_w = $(this).attr("data-starts")
		  method = $(this).attr("data-method")
		  root = $(this).attr("data-root")
		  URL = root+"users/"+chosen_user_id+"/"+method
		  $.ajax
		    url: URL
		    type: "post"
		    data: {starts_with: starts_w}


		 
	$('select#lead_referee_id').change_participants()

	$('select#lead_target_id').change_participants()

	# function adds value to hidden_field depending on which box is clicked
	$.fn.choose_field = ->
		$(this).click ->
			$(this).removeClass("grayed_out")
			$(this).siblings().addClass("grayed_out")

			# determine attribute
			column = $(this).attr("data-field")
			# determine attribute value
			column_value = $(this).attr("data-"+column)
			# populate attributes value in hidden_field
			$("#referral_"+column).val(column_value)
	$.fn.style_field = ->
			# $(this).siblings().addClass("grayed_out")
			# determine attribute
		new_record = $(this).parent().attr("data-new")
		
		column = $(this).attr("data-field")
		column_value = $(this).attr("data-"+column)
		$("#referral_"+column).val(column_value)
		input_value = $("#referral_"+column).val()
		
		if new_record == false
		 	if field == input_value
		 		$("ul").find("[data-"+attr+"='" + input_value + "']").removeClass("grayed_out");
		 else
		 	$("#referral_"+column).removeClass("grayed_out")
			
			
	# referral form choose potential values
	$(".urgency").choose_field()
	$(".card_given").choose_field()
	$(".preferred_contact").choose_field()

	$(".urgency").style_field()
	$(".card_given").style_field()
	$(".preferred_contact").style_field()
	

	$(".warm_up_when").toggle (->
		time_to_contact = $(this).attr("data-when")
		$(".warm_up_now_or_later").hide()
		if (time_to_contact) == "now"
			$(".warm_up_now").show()
		else if (time_to_contact) == "later"
			$(".warm_up_later").show()
	), ->
		$(".warm_up_now").hide()
		$(".warm_up_later").hide()

	$(".abandon_warm_up").click ->
		$(this).closest(".warm_up_now").hide().next().show()

	$(".back_to_warm_up").click ->
		$(this).closest(".warm_up_later").hide().prev().show()	

	$("#referral_contact_by").datepicker
		dateFormat: 'yy-mm-dd'







